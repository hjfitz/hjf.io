---
title: ðŸ¦ƒÂ Nest.js for AWS Lambda with Bundling
date: 2023-05-31T15:55:48.354Z
type: blog
draft: false
path: /nest-js-for-aws-lambda-with-bundling/
category: ""
tags: []
description: ""
featureImg: feature.jpeg

---

There is nothing on the internet around bundling Nest.js for AWS Lambda. The general consensus is that Nest is a backend framework, and as such you shouldnâ€™t need to bundle it. This makes sense: itâ€™s a heavy framework that has a long cold-start time (think, 2 seconds).

However, for an enterprise thatâ€™s constantly hitting a lambda, itâ€™s important that the lambda in question is stable. Nest really excels here, but the codebase is fairly heavy.

## Skeleton With Fastify

Nest is known to drop connections when using Express on a lambda. Fastify is more performant and the AWS Lambda adaptor is officially supported. Below is your adaptor code:

```typescript
undefined
```

Note how we cache the handler for some bonus performance.

## Building with Webpack

Webpack isnâ€™t well documented for Nest, for the reasons discussed above. You can build your code with `nest build --webpack`, but youâ€™ll find that there are some errors:

```typescript
undefined
```

The Nest docs gloss over this, but there are peer dependencies that arenâ€™t really needed for our case. Nest gives a sample Webpack config:

```typescript
undefined
```

And we can add a couple of lazy imports for Fastify peer dependencies:

```typescript
undefined
```

However, weâ€™re also looking to export a handler. When bundling, Webpack removes these - because why would we want to export anything if weâ€™re deploying a bundled executable? 

Webpack allows you to name exports, if youâ€™re building a library. Here, we name our `handler` export, which will be picked up by AWS when we deploy our code. This goes in the root or our `webpack.config.json`.

```typescript
undefined
```

## Conclusion

In some informal testing, Iâ€™ve noticed the *cold-start* time reduction of up to 800ms, which is pretty profound. The bundle size is also significantly smaller then deploying the code + node_modules; a reduction of ~600mb to ~4mb. You can take this even further with minification and some tree shaking!